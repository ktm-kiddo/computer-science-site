<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>mateo.lol</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <div id="app">
    <div class="topnav">
      <router-link to="/" class="nav-link" exact>Home</router-link>
      <router-link to="/about" class="nav-link">About</router-link>
      <router-link to="/contact" class="nav-link">Contact</router-link>
      <select id="themeSwitcher" class="theme-switcher">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
        <option value="solarized">Solarized</option>
        <option value="matrix">Matrix</option>
        <option value="ocean">Ocean</option>
        <option value="retro">Retro</option>
        <option value="cottoncandy">Cotton Candy</option>
        <option value="midnight">Midnight</option>
        <option value="forest">Forest</option>
        <option value="pastel">Pastel</option>
        <option value="bubblegum">Bubblegum</option>
        <option value="citrus">Citrus</option>
        <option value="grape">Grape</option>
        <option value="fire">Fire</option>
      </select>
    </div>
    <router-view></router-view>

  </div>
  <!-- Vue and Router via CDN -->
  <script src="https://unpkg.com/vue@3"></script>
  <script src="https://unpkg.com/vue-router@4">
    
  </script>
  <script>
    // --- Home Page as Vue Component (your main interactive grid) ---
    const Home = {
      template: `
        <div class="grid-container">
          <div class="fact-box box">
            <h3>Fun cat fact!</h3>
            <p>{{ catFact }}</p>
            <button @click="getCatFact" :disabled="catFactLoading">Get new fact!</button>
          </div>
          <div class="photo-box box">
            <h3>Fun cat photo!</h3>
            <img alt="Loading..." :src="catPicUrl" v-if="catPicUrl">
            <button @click="getCatPhoto" :disabled="catPicUrlLoading">Get new photo!</button>
          </div>
          <div class="aqi-box box">
            <h3>AQI</h3>
            <div v-if="weatherData">
              <h5>{{ weatherData.location.name }}, {{ weatherData.location.country }}</h5>
              <h2 class="big">{{ weatherData.current.air_quality.pm2_5 }}</h2>
            </div>
            <div v-else>
              <h5>Loading...</h5>
              <h2 class='big'>Loading...</h2>
            </div>
            <p>Because all cats want to be healthy...</p>
            <button @click="getWeatherData" :disabled="weatherDataLoading">Refresh</button>
          </div>
          <div class="clock-box box">
            <h3>Time</h3>
            <h2 class="big">{{ currentTime }}</h2>
          </div>
          <div class="trivia-box box">
            <h3>Trivia!</h3>
            <p>{{ triviaq }}</p>
            <button @click="truePressed" :class="trueButton" :disabled="triviaButtonDisabled">True</button>
            <button @click="falsePressed" :class="falseButton" :disabled="triviaButtonDisabled">False</button>
            <button @click="getTriviaQuestion" :disabled="newQuestionLoading">Get new question!</button>
          </div>
          <div class="weather-box box">
            <div v-if="weatherData">
              <p class='weathertitle1'>Current</p>
              <img class="weathericon1" :src="weatherData.current.condition.icon">
              <p class='weathertemp1'>{{ weatherData.current.temp_c }}Â°C</p>
            </div>
          </div>
        </div>
      `,
      data() {
        return {
          catFact: '',
          catPicUrl: '',
          catFactLoading: false,
          catPicUrlLoading: false,
          weatherDataLoading: false,
          currentTime: "",
          triviaq: "",
          triviaa: "",
          falseButton: "",
          trueButton: "",
          triviaButtonDisabled: true,
          newQuestionLoading: true,
          weatherData: null,
        }
      },
      methods: {
        getCatFact() {
          this.catFactLoading = true;
          fetch("https://catfact.ninja/fact")
            .then(responseFact => responseFact.json())
            .then(data => {
              this.catFact = data.fact;
              this.catFactLoading = false;
            });
        },
        getCatPhoto() {
          this.catPicUrlLoading = true;
          fetch("https://api.thecatapi.com/v1/images/search")
            .then(response => response.json())
            .then(data => {
              const url = data[0].url;
              // Create a new Image and wait for it to load
              const img = new window.Image();
              img.onload = () => {
                this.catPicUrl = url;
                this.catPicUrlLoading = false;
              };
              img.onerror = () => {
                // handle broken image gracefully
                this.catPicUrl = ""; // or keep the old one
                this.catPicUrlLoading = false;
              };
              img.src = url;
            });
        },
        getWeatherData() {
          this.weatherDataLoading = true;
          const successCallback = (position) => {
            fetch("https://api.weatherapi.com/v1/forecast.json?key=d988d52d87f943079de64335230312&q=" + position.coords.latitude + ", " + position.coords.longitude + "&aqi=yes&alerts=no")
              .then(response => response.json())
              .then(data => {
                this.weatherData = data;
                this.weatherData.current.air_quality.pm2_5 = Math.round(this.weatherData.current.air_quality.pm2_5);
                this.weatherDataLoading = false;
              });
          };
          const errorCallback = (error) => {
            this.weatherDataLoading = false;
            alert('Failed to fetch location for AQI!');
          };
          navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
        },
        showTime() {
          let time = new Date();
          let hour = time.getHours();
          let min = time.getMinutes();
          let sec = time.getSeconds();
          let am_pm = "AM";
          if (hour >= 12) {
            if (hour > 12) hour -= 12;
            am_pm = "PM";
          } else if (hour == 0) {
            hour = 12;
          }
          hour = hour < 10 ? "0" + hour : hour;
          min = min < 10 ? "0" + min : min;
          sec = sec < 10 ? "0" + sec : sec;
          this.currentTime = hour + ":" + min + ":" + sec + am_pm;
        },
        getTriviaQuestion() {
          this.newQuestionLoading = true;
          this.triviaButtonDisabled = true;
          // Open Trivia DB, adds a cache-buster
          const url = "https://opentdb.com/api.php?amount=1&difficulty=easy&type=boolean&" + Math.random();
          fetch(url)
            .then(response => response.json())
            .then(data => {
              if (data.results && data.results.length > 0) {
                // Decode HTML entities
                let q = data.results[0].question.replace(/&quot;/g, '"').replace(/&#039;/g, "'");
                q = q.replace(/&amp;/g, "&");
                this.triviaq = q;
                this.triviaa = data.results[0].correct_answer;
                this.falseButton = "";
                this.trueButton = "";
                this.triviaButtonDisabled = false;
                this.newQuestionLoading = false;
              } else {
                this.triviaq = "Couldn't fetch a question. This may be due to a rate limit. Try again!";
                this.triviaa = "";
                this.falseButton = "";
                this.trueButton = "";
                this.triviaButtonDisabled = false;
                this.newQuestionLoading = false;
              }
            });
        },
        falsePressed() {
          if (this.triviaa === "False") {
            this.falseButton = "correct";
            this.trueButton = "";
            this.triviaButtonDisabled = true;
          } else {
            this.falseButton = "wrong";
            this.trueButton = "";
            this.triviaButtonDisabled = true;
          }
        },
        truePressed() {
          if (this.triviaa === "True") {
            this.trueButton = "correct";
            this.falseButton = "";
            this.triviaButtonDisabled = true;
          } else {
            this.trueButton = "wrong";
            this.falseButton = "";
            this.triviaButtonDisabled = true;
          }
        }
      },
      mounted() {
        this.getCatFact();
        this.getCatPhoto();
        this.getWeatherData();
        this.getTriviaQuestion();
        setInterval(this.showTime, 1000);
      }
    };
    // --- About Page as Vue Component ---
    const About = {
      template: `
        <div>
          <h1>About</h1>
          <p>Welcome to mateo.lol, your ultimate destination for fun facts, trivia, and cat photos!</p>
          <img class="faded" src="/Images/stackedcats.png" alt="Many Cats">
        </div>
      `
    };

    // --- Contact Page as Vue Component ---
    const Contact = {
      data() {
        return {
          name: "",
          email: "",
          message: "",
          submitting: false,
          error: "",
        };
      },
      methods: {
        submitForm() {
          this.error = "";
          this.submitting = true;
          // You can add your access_key here!
          fetch("https://api.web3forms.com/submit", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
              access_key: "your-access-key-here", // replace with your actual access_key!
              name: this.name,
              email: this.email,
              message: this.message,
            }),
          })
            .then(res => res.json())
            .then(data => {
              if (data.success) {
                // Go to thanks page!
                this.$router.push("/thanks");
              } else {
                this.error = "There was a problem submitting your form. Please try again.";
              }
              this.submitting = false;
            })
            .catch(() => {
              this.error = "Network error! Please try again.";
              this.submitting = false;
            });
        },
      },
      template: `
        <div>
          <h1>Contact us!</h1>
          <form @submit.prevent="submitForm">
            <input v-model="name" type="text" name="name" placeholder="Name" class="info" required><br>
            <input v-model="email" type="email" name="email" placeholder="Email" class="info" required><br>
            <textarea v-model="message" name="message" placeholder="Your message" required></textarea><br>
            <button type="submit" class="submit" :disabled="submitting">
              {{ submitting ? "Sending..." : "Send" }}
            </button>
          </form>
          <div v-if="error" style="color: red; margin-top: 1em">{{ error }}</div>
        </div>
      `,
    };

    // --- Thanks Page as Vue Component ---
    const Thanks = {
      template: `
        <div>
          <h3>Thanks!</h3>
          <img src='thankyou.webp'>
          <h2>Your form was submitted successfully.</h2>
          <router-link to="/contact">Go back</router-link>
        </div>
      `
    };

    // --- 404 Page as Vue Component ---
    const NotFound = {
      template: "<div><h1>404 - Not Found</h1></div>"
    };

    // --- Vue Router setup ---
    const routes = [
      {path: '/', component: Home},
      {path: '/about', component: About},
      {path: '/contact', component: Contact},
      {path: '/thanks', component: Thanks},
      {path: '/:pathMatch(.*)*', component: NotFound}
    ];
    const router = VueRouter.createRouter({
      history: VueRouter.createWebHashHistory(),
      routes,
    });

    // --- Main Vue App ---
    const app = Vue.createApp({});
    app.use(router);
    app.mount('#app');

    // --- Theme Switcher logic (unchanged) ---
    const themeKey = 'theme';
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
    }
    const savedTheme = localStorage.getItem(themeKey) || 'dark';
    applyTheme(savedTheme);
    document.getElementById('themeSwitcher').value = savedTheme;
    document.getElementById('themeSwitcher').addEventListener('change', function () {
      applyTheme(this.value);
      localStorage.setItem(themeKey, this.value);
    });
  </script>
</body>

</html>